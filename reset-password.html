<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <link rel="stylesheet" href="style login.css">
</head>
<body>
    <div class="container" id="resetPasswordContainer">
        <div class="form-container">
            <form id="resetPasswordForm">
                <h1>Set New Password</h1>
                <p id="tokenMessage" style="color: red;"></p>
                <div class="input-group">
                    <input type="password" placeholder="New Password" id="newPassword" required aria-label="New Password" />
                    <span class="error-message" id="newPassword-error">
                        <i class="caution-icon"></i> Please enter a new password.
                    </span>
                    </div>
                <div class="input-group">
                    <input type="password" placeholder="Confirm New Password" id="confirmNewPassword" required aria-label="Confirm New Password" />
                    <span class="error-message" id="confirmNewPassword-error">
                        <i class="caution-icon"></i> Please confirm your new password.
                    </span>
                    <span class="error-message" id="resetMismatch-message">
                        <i class="caution-icon"></i> Passwords do not match.
                    </span>
                    <span class="success-message" id="resetMatch-message">PASSWORD MATCHED</span>
                </div>
                <button type="submit">Reset Password</button>
                <p class="back-to-login" style="margin-top: 20px;"><a href="index.html">Back to Sign In</a></p>
                <p id="resetSuccessMessage" style="color: green; display: none; margin-top: 15px;">Your password has been reset successfully. You can now sign in!</p>
            </form>
        </div>
    </div>

    <script>
        const resetPasswordForm = document.getElementById('resetPasswordForm');
        const newPasswordInput = document.getElementById('newPassword');
        const confirmNewPasswordInput = document.getElementById('confirmNewPassword');
        const newPasswordError = document.getElementById('newPassword-error');
        const confirmNewPasswordError = document.getElementById('confirmNewPassword-error');
        const resetMismatchMessage = document.getElementById('resetMismatch-message');
        const resetMatchMessage = document.getElementById('resetMatch-message');
        const resetSuccessMessage = document.getElementById('resetSuccessMessage');
        const tokenMessage = document.getElementById('tokenMessage');

        let resetToken = null;

        // Function to get query parameters from URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // On page load, try to get the token
        window.onload = function() {
            resetToken = getQueryParam('token');
            if (!resetToken) {
                tokenMessage.textContent = 'Error: Password reset token is missing.';
                resetPasswordForm.style.display = 'none'; // Hide the form if no token
            } else {
                // In a real app, send this token to your backend to validate it first.
                // If the token is invalid/expired, show an error and hide the form.
                // For demo, we'll assume it's valid for now.
                console.log('Received reset token:', resetToken);
            }
        };

        function validateResetPasswordMatch() {
            const newPassword = newPasswordInput.value;
            const confirmNewPassword = confirmNewPasswordInput.value;

            if (newPassword === "" || confirmNewPassword === "") {
                resetMismatchMessage.style.display = 'none';
                resetMatchMessage.style.display = 'none';
                return false;
            }

            if (newPassword !== confirmNewPassword) {
                resetMismatchMessage.style.display = 'inline-block';
                resetMatchMessage.style.display = 'none';
                return false;
            } else {
                resetMismatchMessage.style.display = 'none';
                resetMatchMessage.style.display = 'inline-block';
                return true;
            }
        }

        newPasswordInput.addEventListener('input', validateResetPasswordMatch);
        confirmNewPasswordInput.addEventListener('input', validateResetPasswordMatch);

        resetPasswordForm.addEventListener('submit', function(e) {
            e.preventDefault();

            if (!resetToken) {
                alert('Cannot reset password: Missing token.');
                return;
            }

            let isValid = true;
            if (!newPasswordInput.value.trim()) {
                newPasswordError.style.display = 'inline-block';
                isValid = false;
            } else {
                newPasswordError.style.display = 'none';
            }

            if (!confirmNewPasswordInput.value.trim()) {
                confirmNewPasswordError.style.display = 'inline-block';
                isValid = false;
            } else {
                confirmNewPasswordError.style.display = 'none';
            }

            if (!validateResetPasswordMatch()) {
                isValid = false;
            }

            if (isValid) {
                // In a real application, you would send the new password and token to your backend:
                // fetch('/api/reset-password', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify({ token: resetToken, newPassword: newPasswordInput.value })
                // })
                // .then(response => response.json())
                // .then(data => {
                //     if (data.success) {
                //         resetSuccessMessage.style.display = 'block';
                //         resetPasswordForm.reset();
                //         // Optionally redirect after a few seconds
                //         // setTimeout(() => { window.location.href = 'index.html'; }, 3000);
                //     } else {
                //         tokenMessage.textContent = data.message || 'Failed to reset password. Please try again.';
                //         tokenMessage.style.display = 'block';
                //     }
                // })
                // .catch(error => {
                //     console.error('Error:', error);
                //     tokenMessage.textContent = 'An error occurred. Please try again.';
                //     tokenMessage.style.display = 'block';
                // });

                // For demonstration:
                resetSuccessMessage.style.display = 'block';
                resetPasswordForm.reset();
                alert('Demo: Password for ' + resetToken + ' has been reset successfully!');
            }
        });

        // Add blur listeners for new and confirm password inputs
        newPasswordInput.addEventListener('blur', function() {
            if (!this.value.trim()) {
                newPasswordError.style.display = 'inline-block';
            } else {
                newPasswordError.style.display = 'none';
            }
        });

        confirmNewPasswordInput.addEventListener('blur', function() {
            if (!this.value.trim()) {
                confirmNewPasswordError.style.display = 'inline-block';
            } else {
                confirmNewPasswordError.style.display = 'none';
            }
        });
    </script>
</body>
</html>