<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Password Reset System</title>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<style>
/* Reset and global styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
body {
    /* background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); */
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}
/* Container and card */
.container {
    width: 100%;
    max-width: 450px;
}
.card {
    background: #fff;
    border-radius: 15px;
    box-shadow: 0 15px 30px rgba(0,0,0,0.2);
    overflow: hidden;
    transition: transform 0.3s ease;
}
.card:hover {
    transform: translateY(-5px);
}
/* Card header */
.card-header {
    background-color: #4CAF50;
    color: white;
    padding: 25px;
    text-align: center;
}
.card-header h2 {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 5px;
}
.card-header p {
    opacity: 0.9;
    font-size: 14px;
}
/* Card body */
.card-body {
    padding: 25px;
}
/* Form groups */
.form-group {
    margin-bottom: 20px;
}
label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #333;
}
input {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s ease;
}
input:focus {
    outline: none;
    border-color: #4a6ee0;
    box-shadow: 0 0 0 3px rgba(74,110,224,0.2);
}
/* Buttons */
.btn {
    display: block;
    width: 100%;
    padding: 12px;
    background: #007BFF;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}
.btn:hover {
    opacity: 0.9;
    transform: translateY(-2px);
}
.btn:active {
    transform: translateY(0);
}
.btn:disabled {
    background: #cccccc;
    cursor: not-allowed;
    transform: none;
}
/* Messages */
.message {
    margin-top: 15px;
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    font-size: 14px;
    display: none;
}
.success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}
.error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}
.info {
    background-color: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}
/* Steps */
.step {
    display: none;
}
.step.active {
    display: block;
}
/* Links */
.back-link {
    text-align: center;
    margin-top: 15px;
}
.back-link a {
    color: #4a6ee0;
    text-decoration: none;
    font-size: 14px;
}
.back-link a:hover {
    text-decoration: underline;
}
/* Reset instructions */
.reset-instructions {
    background-color: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 14px;
    color: #555;
}
/* Loader */
.loader {
    display: none;
    text-align: center;
    margin: 10px 0;
}
.loader-spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #4a6ee0;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
/* Password strength */
.password-strength {
    margin-top: 5px;
    height: 5px;
    border-radius: 5px;
    background-color: #eee;
    overflow: hidden;
}
.password-strength-bar {
    height: 100%;
    width: 0%;
    transition: width 0.3s, background-color 0.3s;
}
.password-requirements {
    margin-top: 10px;
    font-size: 12px;
    color: #666;
}
.requirement {
    margin-bottom: 3px;
}
.requirement.met {
    color: #28a745;
}
.requirement.met::before {
    content: "✓ ";
}
.requirement:not(.met)::before {
    content: "✗ ";
}
/* Email preview */
.email-preview {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
    font-size: 12px;
    display: none;
}
.email-preview h4 {
    margin-bottom: 10px;
    color: #495057;
}
</style>
</head>
<body>

<div class="container">
<div class="card">
<div class="card-header">
<h2>Password Reset</h2>
<p>Secure your account with a new password</p>
</div>

<div class="card-body">
<!-- Step 1: Request Reset -->
<div class="step active" id="step1">
<div class="reset-instructions">
<p>Enter your email address and we'll send you a link to reset your password.</p>
</div>
<form id="resetRequestForm">
<div class="form-group">
<label for="email">Email Address</label>
<input type="email" id="email" name="email" placeholder="Enter your email" required>
</div>
<button type="submit" class="btn" id="submitBtn">Send Reset Link</button>
</form>
<div class="back-link">
<a href="login.html" id="backToLogin">Back to Login</a>
</div>
<div class="email-preview" id="emailPreview">
<h4>Email Preview (For Testing):</h4>
<div id="previewContent"></div>
</div>
</div>

<!-- Step 2: Check Email -->
<div class="step" id="step2">
<div class="message success" id="successMessage">
Password reset link has been sent to your email!
</div>
<div class="reset-instructions">
<p>We've sent a password reset link to your email address. Please check your inbox and follow the instructions in the email.</p>
<strong><p>If you don't see the email, check your spam folder.</p></strong>
</div>
<div class="back-link">
<a href="#" id="resendLink">Resend reset link</a> | 
<a href="#" id="backToStep1">Use a different email</a>
</div>
</div>

<!-- Step 3: Reset Password -->
<div class="step" id="step3">
<div class="reset-instructions">
<p>Please enter your new password below.</p>
</div>
<form id="resetPasswordForm">
<div class="form-group">
<label for="newPassword">New Password</label>
<input type="password" id="newPassword" name="newPassword" placeholder="Enter new password" required>
<div class="password-strength">
<div class="password-strength-bar" id="passwordStrengthBar"></div>
</div>
<div class="password-requirements" id="passwordRequirements">
<div class="requirement" id="lengthReq">At least 8 characters</div>
<div class="requirement" id="uppercaseReq">One uppercase letter</div>
<div class="requirement" id="lowercaseReq">One lowercase letter</div>
<div class="requirement" id="numberReq">One number</div>
<div class="requirement" id="specialReq">One special character</div>
</div>
</div>
<div class="form-group">
<label for="confirmPassword">Confirm Password</label>
<input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm new password" required>
</div>
<button type="submit" class="btn">Reset Password</button>
</form>
<div class="back-link">
<a href="#" id="backToStep1FromReset">Back</a>
</div>
</div>

<!-- Step 4: Success -->
<div class="step" id="step4">
<div class="message success">
Your password has been reset successfully!
</div>
<div class="reset-instructions">
<p>You can now log in to your account with your new password.</p>
</div>
<a style="text-decoration: none;" href="login.html"><button class="btn" id="goToLogin">Go to Login</button></a>
</div>

<!-- Loader -->
<div class="loader" id="loader">
<div class="loader-spinner"></div>
<p>Sending reset link...</p>
</div>

<div class="message error" id="errorMessage"></div>
</div>
</div>
</div>

<script>
emailjs.init("ieCJeX-5LsiuaA20c");

const step1=document.getElementById('step1'),
      step2=document.getElementById('step2'),
      step3=document.getElementById('step3'),
      step4=document.getElementById('step4'),
      resetRequestForm=document.getElementById('resetRequestForm'),
      resetPasswordForm=document.getElementById('resetPasswordForm'),
      successMessage=document.getElementById('successMessage'),
      errorMessage=document.getElementById('errorMessage'),
      loader=document.getElementById('loader'),
      backToLogin=document.getElementById('backToLogin'),
      resendLink=document.getElementById('resendLink'),
      backToStep1=document.getElementById('backToStep1'),
      backToStep1FromReset=document.getElementById('backToStep1FromReset'),
      goToLogin=document.getElementById('goToLogin'),
      passwordStrengthBar=document.getElementById('passwordStrengthBar'),
      passwordRequirements=document.getElementById('passwordRequirements').children,
      submitBtn=document.getElementById('submitBtn'),
      emailPreview=document.getElementById('emailPreview'),
      previewContent=document.getElementById('previewContent'),
      newPassword=document.getElementById('newPassword'),
      confirmPassword=document.getElementById('confirmPassword');

let userEmail='';

function showStep(n){ [step1,step2,step3,step4].forEach(s=>s.classList.remove('active')); document.getElementById(`step${n}`).classList.add('active'); hideMessage(); }
function showMessage(msg,type){ errorMessage.textContent=msg; errorMessage.className=`message ${type}`; errorMessage.style.display='block'; if(type==='success') setTimeout(hideMessage,5000); }
function hideMessage(){ errorMessage.style.display='none'; }
function showLoader(){ loader.style.display='block'; submitBtn.disabled=true; }
function hideLoader(){ loader.style.display='none'; submitBtn.disabled=false; }
function generateResetToken(){ return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15); }

function checkPasswordStrength(password){
    let strength=0;
    const reqs={length:password.length>=8,uppercase:/[A-Z]/.test(password),lowercase:/[a-z]/.test(password),number:/[0-9]/.test(password),special:/[^A-Za-z0-9]/.test(password)};
    for(let i=0;i<passwordRequirements.length;i++){
        const req=passwordRequirements[i]; const id=req.id.replace('Req','');
        if(reqs[id]) req.classList.add('met'); else req.classList.remove('met');
    }
    if(reqs.length) strength+=20; if(reqs.uppercase) strength+=20; if(reqs.lowercase) strength+=20; if(reqs.number) strength+=20; if(reqs.special) strength+=20;
    passwordStrengthBar.style.width=`${strength}%`;
    passwordStrengthBar.style.backgroundColor=strength<40?'#e74c3c':strength<80?'#f39c12':'#2ecc71';
    return strength;
}

function validatePassword(password){ return password.length>=8 && /[A-Z]/.test(password) && /[a-z]/.test(password) && /\d/.test(password) && /[^A-Za-z0-9]/.test(password); }

function showEmailPreview(email,resetLink){
    previewContent.innerHTML=`<p><strong>To:</strong> ${email}</p><p><strong>Reset Link:</strong> ${resetLink}</p>`;
    emailPreview.style.display='block';
}

async function sendResetEmail(email,token){
    const resetLink=`${window.location.origin}/reset-password.html?token=${token}&email=${encodeURIComponent(email)}`;
    showEmailPreview(email,resetLink);
    const templateParams={ reset_link:resetLink, email:email, to_name:email.split('@')[0], to_email:email, website_link:"https://lostfoundhub.com", company_name:"Lost & Found Hub" };
    try { return await emailjs.send('service_csp5v7g','template_mqdxb6s',templateParams); }
    catch(err){ console.error(err); throw err; }
}

resetRequestForm.addEventListener('submit',async e=>{
    e.preventDefault();
    const email=document.getElementById('email').value.trim();
    if(!email||!email.includes('@')||!email.includes('.')){ showMessage('Enter valid email','error'); return; }
    userEmail=email; showLoader(); hideMessage();
    try{
        const token=generateResetToken();
        await sendResetEmail(email,token);
        hideLoader(); showStep(2); successMessage.textContent=`Password reset link has been sent to ${email}!`; successMessage.style.display='block';
    } catch(err){ hideLoader(); showMessage('Failed to send reset email','error'); }
});

resetPasswordForm.addEventListener('submit',e=>{
    e.preventDefault();
    const password=newPassword.value, confirm=confirmPassword.value;
    if(!validatePassword(password)){ showMessage('Password does not meet requirements','error'); return; }
    if(password!==confirm){ showMessage('Passwords do not match','error'); return; }
    const token=(new URLSearchParams(window.location.search)).get('token');
    if(!token){ showMessage('Invalid reset token','error'); return; }
    setTimeout(()=>{ showStep(4); },1000);
});

newPassword.addEventListener('input',()=>{ checkPasswordStrength(newPassword.value); });

backToLogin.addEventListener('click',e=>{ e.preventDefault(); alert('Redirecting to login page...');  window.location.href='login.html';});
resendLink.addEventListener('click',e=>{ e.preventDefault(); showStep(1); document.getElementById('email').value=userEmail; });
backToStep1.addEventListener('click',e=>{ e.preventDefault(); showStep(1); document.getElementById('email').value=''; });
backToStep1FromReset.addEventListener('click',e=>{ e.preventDefault(); showStep(1); });
goToLogin.addEventListener('click',()=>{ alert('Redirecting to login page...'); });

window.addEventListener('load',()=>{
    const params=new URLSearchParams(window.location.search);
    const token=params.get('token'); const email=params.get('email');
    if(token&&email){ userEmail=email; showStep(3); showMessage('Reset token received from email link. You can now set your new password.','info'); setTimeout(hideMessage,5000); }
});
</script>
</body>
</html>
