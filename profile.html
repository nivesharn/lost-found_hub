<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile | Lost & Found Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Include jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        /* Header Styles */
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            max-width: 1200px;
            margin: 0 auto;
            width: 90%;
        }

        .logo {
            font-size: 1.8em;
            font-weight: bold;
            color: #4CAF50;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .logo a {
            text-decoration: none;
            color: #4CAF50;
        }   

        .logo i {
            font-size: 1.2em;
            color:#007BFF;
        }

        nav {
            flex: 1;
            max-width: 300px;
            margin: 0 20px;
        }

        nav ul {
            display: flex;
            list-style: none;
            justify-content: space-between;
        }
        
        nav ul li a {
            text-decoration: none;
            color: black;
            padding: 10px 15px;
            border-radius: 4px;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            white-space: nowrap;
        }

        nav ul li a:hover {
            background-color: #e9ecef;;
            color: #007BFF;        
        }

        nav ul li a i {
            margin-right: 8px;
        }

        .account-section {
            position: relative;
        }
        
        .account-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #4CAF50;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
            overflow: hidden;
            border-radius: 50%;
            border: 3px solid #007BFF;
        }
        
        .account-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .account-icon:hover {
            background-color: #3d8b40;
        }
        
        .dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 280px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 10px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-user-info {
            display: flex;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #4CAF50;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            margin-right: 15px;
            overflow: hidden;
            border-radius: 50%;
            border: 3px solid #007BFF;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-details h3 {
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .user-details p {
            color: #777;
            font-size: 0.9rem;
        }
        
         .dropdown-menu {
            list-style: none;
            padding: 10px 0;
            margin: 0;
        }
        .dropdown-menu li {
            margin: 0;
        }
        .dropdown-menu li a {
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--text-color);
            text-decoration: none;
        }
        .dropdown-menu li a:hover {
            background-color: #f4f7f6;
        }
        .logout-btn {
            color: #e74c3c !important;
        }

        .hamburger-menu {
            display: none; 
            font-size: 1.8em;
            color: var(--text-color);
            cursor: pointer;
            background: none;
            border: none;
            padding: 5px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        .hamburger-menu:hover {
            background-color: var(--bg-color-dark);
        }

        /* Main Content Styles */
        .container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        h2 {
            color: #444;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        h3 {
            color: #555;
            margin-bottom: 15px;
        }

        p {
            color: #666;
            margin-bottom: 15px;
        }

        .btn {
            display: inline-block;
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.3s;
            border: none;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background-color: #3d8b40;
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-info {
            background-color: #17a2b8;
        }

        .btn-info:hover {
            background-color: #138496;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .profile-avatar {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-right: 30px;
            overflow: hidden;
            background-color: #e0e0e0;
            border-radius: 50%;
            border: 3px solid #007BFF;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-info h1 {
            margin-bottom: 5px;
        }

        .profile-info p {
            color: #777;
            margin-bottom: 0;
        }

        .avatar-upload {
            margin-top: 10px;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            background-color: #f0f0f0;
            color: #333;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }

        .file-label:hover {
            background-color: #e0e0e0;
        }

        .help-text {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
        }

        .profile-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .detail-card {
            background-color: #f9fafc;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #4CAF50;
        }

        .detail-card h3 {
            margin-bottom: 10px;
            color: #4CAF50;
        }

        .detail-card p {
            margin-bottom: 8px;
        }

        .detail-card strong {
            color: #555;
            display: inline-block;
            width: 160px;
        }

        .activity-section {
            margin-top: 30px;
        }

        .activity-list {
            list-style: none;
        }

        .activity-list li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }

        .activity-list li:last-child {
            border-bottom: none;
        }

        .activity-date {
            color: #777;
            font-size: 0.9em;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            border-color: #4CAF50;
            outline: none;
        }

        .edit-form {
            display: none;
        }

        .edit-form.active {
            display: block;
        }

        .view-mode.active {
            display: block;
        }

        .view-mode {
            display: none;
        }

        /* Security Section Styles */
        .security-section {
            margin-top: 30px;
        }

        .security-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .security-card {
            background-color: #f9fafc;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #007BFF;
        }

        .security-card h3 {
            margin-bottom: 10px;
            color: #007BFF;
        }

        .security-card p {
            margin-bottom: 8px;
        }

        .security-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .status-enabled {
            background-color: #d4edda;
            color: #155724;
        }

        .status-disabled {
            background-color: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .security-actions {
            margin-top: 15px;
        }

        /* Activity Section Styles */
        .activity-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background-color: #f0f0f0;
            color: #555;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .filter-btn.active {
            background-color: #4CAF50;
            color: white;
        }

        .filter-btn:hover {
            background-color: #e0e0e0;
        }

        .filter-btn.active:hover {
            background-color: #3d8b40;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: #555;
        }

        .activity-details {
            flex: 1;
        }

        .activity-details p {
            margin: 0;
        }

        .activity-meta {
            display: flex;
            justify-content: space-between;
            color: #777;
            font-size: 0.9em;
        }

        .activity-date {
            color: #777;
            font-size: 0.9em;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #333;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
        }

        .close-modal:hover {
            color: #333;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Security Settings Styles (from first code) */
        .security-item {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .security-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .status-enabled {
            background-color: #e8f6ef;
            color: #27ae60;
        }

        .status-disabled {
            background-color: #fdeaea;
            color: #e74c3c;
        }

        .status-set {
            background-color: #e8f4fd;
            color: #3498db;
        }

        .divider {
            height: 1px;
            background-color: #e0e0e0;
            margin: 20px 0;
        }

        .session-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .session-details {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .device-icon {
            width: 40px;
            height: 40px;
            background-color: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .session-text h4 {
            margin-bottom: 3px;
        }

        .session-text p {
            font-size: 0.85rem;
            color: #777;
        }

        .question-item {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }

        .question-text {
            margin-bottom: 10px;
            font-weight: 500;
        }

        .answer-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .session-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .session-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .session-item:last-child {
            border-bottom: none;
        }

        .current-session {
            background-color: #e8f4fd;
            border-left: 4px solid #3498db;
        }

        .session-actions {
            display: flex;
            gap: 10px;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
            padding: 5px 10px;
            font-size: 0.85rem;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .header-content {
                flex-wrap: wrap;
            }
            
            nav {
                order: 3;
                max-width: 100%;
                margin: 15px 0 0 0;
                display: none;
            }
            
            nav.active {
                display: block;
            }
            
            nav ul {
                flex-direction: column;
                width: 100%;
            }
            
            nav ul li {
                margin-bottom: 5px;
            }
            
            nav ul li a {
                justify-content: center;
            }
            
            .hamburger-menu {
                display: block;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-avatar {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .profile-details {
                grid-template-columns: 1fr;
            }
            
            .security-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-container {
                display: flex;
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-search-location" style="color: #007BFF;"></i>
                <a href="index.html"><span>Lost & Found Hub</span></a>
            </div>
            <nav id="mainNav">
                <ul>
                    <li><a href="index.html" aria-label="Home"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="submit-item.html" id="navSubmitItem" aria-label="Submit Item"><i class="fas fa-plus-circle"></i> Submit Item</a></li>
                </ul>
            </nav>
            <div class="account-section" id="accountSection">
                <div class="account-icon" id="accountIcon">
                    <i class="fas fa-user" id="accountIconFallback"></i>
                    <img id="accountIconImage" style="display: none;" alt="User Avatar">
                </div>
                <div class="dropdown" id="accountDropdown">
                    <div class="dropdown-user-info">
                        <div class="user-avatar">
                            <i class="fas fa-user" id="dropdownAvatarFallback"></i>
                            <img id="dropdownAvatarImage" style="display: none;" alt="User Avatar">
                        </div>
                        <div class="user-details">
                            <h3 id="username">nivesh1262</h3>
                            <p id="useremail">niveshr@karunya.edu.in</p>
                        </div>
                    </div>
                    <ul class="dropdown-menu">
                        <li><a href="help.html"><i class="fas fa-question-circle"></i> Help & Support</a></li>
                        <li><a href="#"><i class="fas fa-bell"></i> Notifications</a></li>
                        <li><a href="contact.html" aria-label="Home"><i class="fas fa-phone contact-icons"></i> Contact</a></li>
                        <li><a href="settings.html"><i class="fas fa-cog"></i> Settings</a></li>
                        <li><a href="login.html" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                    </ul>
                </div>
            </div>
            <div class="hamburger-menu" id="hamburgerMenu" role="button"><i class="fas fa-bars"></i></div>
        </div>
    </header>

    <div class="container">
        <div class="card">
            <div class="profile-header">
                <div class="profile-avatar">
                    <img src="https://i.pravatar.cc/150?img=12" alt="User Avatar" id="avatar-image">
                </div>
                <div class="profile-info">
                    <h1 id="profileUsername">nivesh1262</h1>
                    <p id="profileEmail">niveshr@karunya.edu.in</p>
                    <p>Member since: <span id="memberSince">October 2025</span></p>
                    
                    <div class="avatar-upload">
                        <input type="file" id="avatar-upload" class="file-input" accept="image/*">
                        <label for="avatar-upload" class="file-label">Change Avatar</label>
                        <p class="help-text">JPG, PNG or GIF, max 2MB</p>
                    </div>
                </div>
            </div>

            <h2>Account Details</h2>
            <div class="btn-container" style="margin-top: 30px;">
                <button class="btn" id="editProfileBtn"><i class="fas fa-edit"></i> Edit Profile</button>
                <button class="btn btn-secondary" id="changePasswordBtn"><i class="fas fa-lock"></i> Change Password</button>
            </div>
            
            <!-- View Mode (read-only) -->
            <div class="view-mode active" id="profileViewMode">
                <div class="profile-details">
                    <div class="detail-card">
                        <h3>Personal Information</h3>
                        <p><strong>Full Name:</strong> <span id="profileFullName">NIVESHedu</span></p>
                        <p><strong>Username:</strong> <span id="profileUsernameDetail">nivesh1262</span></p>
                        <p><strong>Email:</strong> <span id="profileEmailDetail">niveshr@karunya.edu.in</span></p>
                        <p><strong>Phone:</strong> <span id="profilePhone">+1 (555) 123-4567</span></p>
                        <p><strong>Location:</strong> <span id="profileLocation">New York, USA</span></p>
                    </div>

                    <div class="detail-card">
                        <h3>Security</h3>
                        <p><strong>Password Last Changed:</strong> <span id="passwordLastChanged">3 months ago</span></p>
                        <p><strong>Security Questions:</strong> <span id="securityQuestionsStatus" class="security-status status-enabled">Set</span></p>
                        <p><strong>Account Recovery:</strong> <span id="accountRecoveryStatus" class="security-status status-enabled">Enabled</span></p>
                        <p><strong>Privacy Level:</strong> <span id="privacyLevel">Standard</span></p>
                    </div>
                </div>
            </div>
            
            <!-- Edit Mode (form) -->
            <div class="edit-form" id="profileEditForm">
                <div class="profile-details">
                    <div class="detail-card">
                        <h3>Personal Information</h3>
                        <div class="form-group">
                            <label for="editFullName">Full Name</label>
                            <input type="text" id="editFullName" class="form-control" value="NIVESHedu">
                        </div>
                        <div class="form-group">
                            <label for="editUsername">Username</label>
                            <input type="text" id="editUsername" class="form-control" value="nivesh1262">
                        </div>
                        <div class="form-group">
                            <label for="editEmail">Email</label>
                            <input type="email" id="editEmail" class="form-control" value="niveshr@karunya.edu.in">
                        </div>
                        <div class="form-group">
                            <label for="editPhone">Phone</label>
                            <input type="tel" id="editPhone" class="form-control" value="+1 (555) 123-4567">
                        </div>
                        <div class="form-group">
                            <label for="editLocation">Location</label>
                            <input type="text" id="editLocation" class="form-control" value="New York, USA">
                        </div>
                    </div>
                </div>
                <div class="btn-container" style="margin-top: 20px;">
                    <button class="btn" id="saveProfileBtn"><i class="fas fa-save"></i> Save Changes</button>
                    <button class="btn btn-secondary" id="cancelEditBtn"><i class="fas fa-times"></i> Cancel</button>
                </div>
            </div>
            
            <!-- Enhanced Security Section -->
            <div class="security-section">
                <h2>Security Settings</h2>
                
                <div class="security-item">
                    <h3>Two-Factor Authentication</h3>
                    <p>Add an extra layer of security to your account</p>
                    <div class="status status-disabled">Disabled</div>
                    <button class="btn btn-info" id="enable2fa">Enable 2FA</button>
                </div>
                
                <div class="divider"></div>
                
                <div class="security-item">
                    <h3>Security Questions</h3>
                    <p>Set up security questions for account recovery</p>
                    <div class="status status-set">Set</div>
                    <button class="btn btn-info" id="manageQuestions">Manage Questions</button>
                </div>
                
                <div class="divider"></div>
                
                <div class="security-item">
                    <h3>Login Sessions</h3>
                    <p>Manage your active login sessions</p>
                    <div class="session-info">
                        <div>
                            <strong>Active Sessions:</strong> 1
                        </div>
                        <button class="btn btn-info" id="viewSessions">View Sessions</button>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Activity Section -->
            <div class="activity-section">
                <h2>Recent Activity</h2>
                
                <div class="activity-filters">
                    <button class="filter-btn active" data-filter="all">All Activity</button>
                    <button class="filter-btn" data-filter="login">Logins</button>
                    <button class="filter-btn" data-filter="profile">Profile Changes</button>
                    <button class="filter-btn" data-filter="security">Security</button>
                    <button class="filter-btn" data-filter="items">Items</button>
                </div>
                
                <div id="activityList">
                    <!-- Activity items will be dynamically inserted here -->
                </div>
                
                <div class="btn-container" style="margin-top: 20px;">
                    <button class="btn btn-secondary" id="loadMoreActivityBtn">Load More Activity</button>
                    <button class="btn btn-info" id="exportActivityBtn"><i class="fas fa-file-pdf"></i> Export Activity Log (PDF)</button>
                </div>
            </div>

            <div class="btn-container" style="margin-top: 30px;">
                <button class="btn" id="deleteAccountBtn" style="background-color: #e74c3c;"><i class="fas fa-trash-alt"></i> Delete Account</button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Change Password</h3>
                <button class="close-modal" id="closePasswordModal">&times;</button>
            </div>
            <form id="passwordForm">
                <div class="form-group">
                    <label for="currentPassword">Current Password</label>
                    <input type="password" id="currentPassword" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <input type="password" id="newPassword" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password</label>
                    <input type="password" id="confirmPassword" class="form-control" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelPasswordBtn">Cancel</button>
                    <button type="submit" class="btn" id="savePasswordBtn">Change Password</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Two-Factor Authentication Modal -->
    <div class="modal" id="twoFactorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Two-Factor Authentication</h3>
                <button class="close-modal" id="close2FAModal">&times;</button>
            </div>
            <div id="twoFactorSetup">
                <p>Scan the QR code with your authenticator app:</p>
                <div style="text-align: center; margin: 20px 0;">
                    <div id="qrcode" style="display: inline-block; padding: 10px; background: white; border: 1px solid #ddd;"></div>
                </div>
                <p>Or enter this code manually: <strong id="manualCode">JBSWY3DPEHPK3PXP</strong></p>
                <div class="form-group">
                    <label for="twoFactorCode">Enter the 6-digit code from your app:</label>
                    <input type="text" id="twoFactorCode" class="form-control" maxlength="6" placeholder="123456">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancel2FABtn">Cancel</button>
                    <button type="button" class="btn" id="verify2FABtn">Verify & Enable</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Account Modal -->
    <div class="modal" id="deleteAccountModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Delete Account</h3>
                <button class="close-modal" id="closeDeleteModal">&times;</button>
            </div>
            <p>Are you sure you want to delete your account? This action cannot be undone. All your data will be permanently removed.</p>
            <div class="form-group">
                <label for="confirmDelete">Type "DELETE" to confirm</label>
                <input type="text" id="confirmDelete" class="form-control" placeholder="DELETE">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelDeleteBtn">Cancel</button>
                <button type="button" class="btn" id="confirmDeleteBtn" style="background-color: #e74c3c;">Delete Account</button>
            </div>
        </div>
    </div>

    <!-- Manage Questions Modal -->
    <div class="modal" id="questionsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Manage Security Questions</h3>
                <button class="close-modal" id="closeQuestions">&times;</button>
            </div>
            <p>Update your security questions for account recovery.</p>
            
            <div class="question-item">
                <div class="question-text">What was the name of your first pet?</div>
                <input type="text" class="answer-input" placeholder="Your answer">
            </div>
            
            <div class="question-item">
                <div class="question-text">What is your mother's maiden name?</div>
                <input type="text" class="answer-input" placeholder="Your answer">
            </div>
            
            <div class="question-item">
                <div class="question-text">What city were you born in?</div>
                <input type="text" class="answer-input" placeholder="Your answer">
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelQuestions">Cancel</button>
                <button class="btn btn-success" id="saveQuestions">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- View Sessions Modal -->
    <div class="modal" id="sessionsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Active Login Sessions</h3>
                <button class="close-modal" id="closeSessions">&times;</button>
            </div>
            <p>Manage your active login sessions across devices.</p>
            
            <div class="session-list">
                <div class="session-item current-session">
                    <div class="session-details">
                        <div class="device-icon">ðŸ’»</div>
                        <div class="session-text">
                            <h4>Chrome on Windows</h4>
                            <p>Current session â€¢ New York, USA</p>
                            <p>Last active: Just now</p>
                        </div>
                    </div>
                </div>
                
                <!-- <div class="session-item">
                    <div class="session-details">
                        <div class="device-icon">ðŸ“±</div>
                        <div class="session-text">
                            <h4>Safari on iPhone</h4>
                            <p>Last active: 2 days ago</p>
                            <p>Chicago, USA</p>
                        </div>
                    </div>
                    <div class="session-actions">
                        <button class="btn btn-danger">Log Out</button>
                    </div>
                </div> -->
                
                <div class="session-item">
                    <div class="session-details">
                        <!-- <div class="device-icon">ðŸ’»</div>
                        <div class="session-text">
                            <h4>Firefox on MacOS</h4>
                            <p>Last active: 1 week ago</p>
                            <p>San Francisco, USA</p>
                        </div> -->
                    </div>
                    <div class="session-actions">
                        <button class="btn btn-danger">Log Out</button>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeAllSessions">Log Out All Other Sessions</button>
                <button class="btn btn-primary" id="closeSessionsBtn">Close</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const accountIcon = document.getElementById('accountIcon');
        const accountIconImage = document.getElementById('accountIconImage');
        const accountIconFallback = document.getElementById('accountIconFallback');
        const accountDropdown = document.getElementById('accountDropdown');
        const accountSection = document.getElementById('accountSection');
        const dropdownAvatarImage = document.getElementById('dropdownAvatarImage');
        const dropdownAvatarFallback = document.getElementById('dropdownAvatarFallback');
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const mainNav = document.getElementById('mainNav');
        const avatarUpload = document.getElementById('avatar-upload');
        const avatarImage = document.getElementById('avatar-image');
        const editProfileBtn = document.getElementById('editProfileBtn');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const deleteAccountBtn = document.getElementById('deleteAccountBtn');
        const profileViewMode = document.getElementById('profileViewMode');
        const profileEditForm = document.getElementById('profileEditForm');
        const changePasswordModal = document.getElementById('changePasswordModal');
        const closePasswordModal = document.getElementById('closePasswordModal');
        const cancelPasswordBtn = document.getElementById('cancelPasswordBtn');
        const passwordForm = document.getElementById('passwordForm');
        const deleteAccountModal = document.getElementById('deleteAccountModal');
        const closeDeleteModal = document.getElementById('closeDeleteModal');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const confirmDeleteInput = document.getElementById('confirmDelete');
        const enable2FABtn = document.getElementById('enable2fa');
        const viewSessionsBtn = document.getElementById('viewSessions');
        const manageQuestionsBtn = document.getElementById('manageQuestions');
        const twoFactorModal = document.getElementById('twoFactorModal');
        const close2FAModal = document.getElementById('close2FAModal');
        const cancel2FABtn = document.getElementById('cancel2FABtn');
        const verify2FABtn = document.getElementById('verify2FABtn');
        const twoFactorCode = document.getElementById('twoFactorCode');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const activityList = document.getElementById('activityList');
        const loadMoreActivityBtn = document.getElementById('loadMoreActivityBtn');
        const exportActivityBtn = document.getElementById('exportActivityBtn');

        // Security Modals
        const questionsModal = document.getElementById('questionsModal');
        const sessionsModal = document.getElementById('sessionsModal');
        const closeQuestions = document.getElementById('closeQuestions');
        const closeSessions = document.getElementById('closeSessions');
        const cancelQuestions = document.getElementById('cancelQuestions');
        const closeSessionsBtn = document.getElementById('closeSessionsBtn');
        const saveQuestions = document.getElementById('saveQuestions');
        const closeAllSessions = document.getElementById('closeAllSessions');

        // Activity data
        let allActivities = [];
        let filteredActivities = [];
        let currentFilter = 'all';
        let activitiesToShow = 10;

        // Function to update avatar in all locations
        function updateAllAvatars(avatarUrl) {
            // Update main profile avatar
            avatarImage.src = avatarUrl;
            
            // Update account icon avatar
            if (avatarUrl && avatarUrl !== '') {
                accountIconImage.src = avatarUrl;
                accountIconImage.style.display = 'block';
                accountIconFallback.style.display = 'none';
                
                // Update dropdown avatar
                dropdownAvatarImage.src = avatarUrl;
                dropdownAvatarImage.style.display = 'block';
                dropdownAvatarFallback.style.display = 'none';
            } else {
                // Show fallback icons if no avatar
                accountIconImage.style.display = 'none';
                accountIconFallback.style.display = 'block';
                dropdownAvatarImage.style.display = 'none';
                dropdownAvatarFallback.style.display = 'block';
            }
        }

        // Toggle dropdown menu
        accountIcon.addEventListener('click', function(e) {
            e.stopPropagation();
            accountDropdown.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!accountSection.contains(e.target)) {
                accountDropdown.classList.remove('active');
            }
        });

        // Toggle mobile navigation
        hamburgerMenu.addEventListener('click', function() {
            mainNav.classList.toggle('active');
        });

        // Toggle between view and edit modes
        editProfileBtn.addEventListener('click', function() {
            profileViewMode.classList.remove('active');
            profileEditForm.classList.add('active');
        });

        cancelEditBtn.addEventListener('click', function() {
            profileViewMode.classList.add('active');
            profileEditForm.classList.remove('active');
        });

        // Save profile changes
        saveProfileBtn.addEventListener('click', async function() {
            const updatedProfile = {
                fullName: document.getElementById('editFullName').value,
                username: document.getElementById('editUsername').value,
                email: document.getElementById('editEmail').value,
                phone: document.getElementById('editPhone').value,
                location: document.getElementById('editLocation').value
            };

            const success = await updateProfile(updatedProfile);
            
            if (success) {
                // Update view mode with new values
                document.getElementById('profileFullName').textContent = updatedProfile.fullName;
                document.getElementById('profileUsername').textContent = updatedProfile.username;
                document.getElementById('profileUsernameDetail').textContent = updatedProfile.username;
                document.getElementById('profileEmail').textContent = updatedProfile.email;
                document.getElementById('profileEmailDetail').textContent = updatedProfile.email;
                document.getElementById('profilePhone').textContent = updatedProfile.phone;
                document.getElementById('profileLocation').textContent = updatedProfile.location;
                
                // Also update dropdown
                document.getElementById('username').textContent = updatedProfile.username;
                document.getElementById('useremail').textContent = updatedProfile.email;
                
                // Add activity
                addActivity({
                    type: 'profile',
                    title: 'Profile Updated',
                    description: 'You updated your profile information',
                    timestamp: new Date()
                });
                
                // Switch back to view mode
                profileViewMode.classList.add('active');
                profileEditForm.classList.remove('active');
                
                showNotification('Profile updated successfully!', 'success');
            } else {
                showNotification('Failed to update profile. Please try again.', 'error');
            }
        });

        // Avatar upload functionality
        avatarUpload.addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    showNotification('File size exceeds 2MB limit. Please choose a smaller file.', 'error');
                    return;
                }
                if (!file.type.match('image.*')) {
                    showNotification('Please select an image file (JPG, PNG, or GIF).', 'error');
                    return;
                }
                
                const success = await uploadAvatar(file);
                if (success) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const newAvatarUrl = e.target.result;
                        updateAllAvatars(newAvatarUrl);
                        
                        // Add activity
                        addActivity({
                            type: 'profile',
                            title: 'Avatar Updated',
                            description: 'You changed your profile picture',
                            timestamp: new Date()
                        });
                        
                        showNotification('Avatar updated successfully!', 'success');
                    };
                    reader.readAsDataURL(file);
                } else {
                    showNotification('Failed to upload avatar. Please try again.', 'error');
                }
            }
        });

        // Change password modal
        changePasswordBtn.addEventListener('click', function() {
            changePasswordModal.classList.add('active');
        });

        closePasswordModal.addEventListener('click', function() {
            changePasswordModal.classList.remove('active');
            passwordForm.reset();
        });

        cancelPasswordBtn.addEventListener('click', function() {
            changePasswordModal.classList.remove('active');
            passwordForm.reset();
        });

        // Password form submission
        passwordForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                showNotification('New passwords do not match.', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('Password must be at least 6 characters long.', 'error');
                return;
            }
            
            const success = await changePassword(currentPassword, newPassword);
            if (success) {
                // Update password last changed
                document.getElementById('passwordLastChanged').textContent = 'Just now';
                
                // Add activity
                addActivity({
                    type: 'security',
                    title: 'Password Changed',
                    description: 'You changed your account password',
                    timestamp: new Date()
                });
                
                showNotification('Password changed successfully!', 'success');
                changePasswordModal.classList.remove('active');
                passwordForm.reset();
            } else {
                showNotification('Failed to change password. Please check your current password.', 'error');
            }
        });

        // Two-Factor Authentication
        enable2FABtn.addEventListener('click', function() {
            twoFactorModal.classList.add('active');
        });

        close2FAModal.addEventListener('click', function() {
            twoFactorModal.classList.remove('active');
            twoFactorCode.value = '';
        });

        cancel2FABtn.addEventListener('click', function() {
            twoFactorModal.classList.remove('active');
            twoFactorCode.value = '';
        });

        verify2FABtn.addEventListener('click', async function() {
            const code = twoFactorCode.value;
            if (code.length !== 6 || !/^\d+$/.test(code)) {
                showNotification('Please enter a valid 6-digit code.', 'error');
                return;
            }
            
            const success = await enableTwoFactorAuth(code);
            if (success) {
                document.querySelector('.status.status-disabled').textContent = 'Enabled';
                document.querySelector('.status.status-disabled').className = 'status status-enabled';
                
                // Add activity
                addActivity({
                    type: 'security',
                    title: '2FA Enabled',
                    description: 'You enabled two-factor authentication',
                    timestamp: new Date()
                });
                
                showNotification('Two-factor authentication enabled successfully!', 'success');
                twoFactorModal.classList.remove('active');
                twoFactorCode.value = '';
            } else {
                showNotification('Invalid code. Please try again.', 'error');
            }
        });

        // Security Modals
        manageQuestionsBtn.addEventListener('click', () => {
            questionsModal.classList.add('active');
        });
        
        viewSessionsBtn.addEventListener('click', () => {
            sessionsModal.classList.add('active');
        });
        
        // Close modals
        closeQuestions.addEventListener('click', () => {
            questionsModal.classList.remove('active');
        });
        
        closeSessions.addEventListener('click', () => {
            sessionsModal.classList.remove('active');
        });
        
        cancelQuestions.addEventListener('click', () => {
            questionsModal.classList.remove('active');
        });
        
        closeSessionsBtn.addEventListener('click', () => {
            sessionsModal.classList.remove('active');
        });
        
        // Save questions
        saveQuestions.addEventListener('click', () => {
            alert('Security questions updated successfully!');
            questionsModal.classList.remove('active');
        });
        
        // Close all sessions
        closeAllSessions.addEventListener('click', () => {
            if (confirm('Are you sure you want to log out all other sessions?')) {
                alert('All other sessions have been logged out.');
                sessionsModal.classList.remove('active');
            }
        });
        
        // Log out individual sessions
        document.querySelectorAll('.btn-danger').forEach(button => {
            button.addEventListener('click', function() {
                const deviceName = this.closest('.session-item').querySelector('h4').textContent;
                if (confirm(`Are you sure you want to log out from ${deviceName}?`)) {
                    this.closest('.session-item').style.opacity = '0.5';
                    setTimeout(() => {
                        this.closest('.session-item').remove();
                    }, 500);
                }
            });
        });

        // Activity filtering
        filterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons
                filterBtns.forEach(b => b.classList.remove('active'));
                
                // Add active class to clicked button
                this.classList.add('active');
                
                // Update current filter
                currentFilter = this.getAttribute('data-filter');
                
                // Filter activities
                filterActivities();
            });
        });

        // Load more activities
        loadMoreActivityBtn.addEventListener('click', function() {
            activitiesToShow += 10;
            displayActivities();
        });

        // Export activity log as PDF
        exportActivityBtn.addEventListener('click', function() {
            exportActivityLogAsPDF();
        });

        // Delete account modal
        deleteAccountBtn.addEventListener('click', function() {
            deleteAccountModal.classList.add('active');
        });

        closeDeleteModal.addEventListener('click', function() {
            deleteAccountModal.classList.remove('active');
            confirmDeleteInput.value = '';
        });

        cancelDeleteBtn.addEventListener('click', function() {
            deleteAccountModal.classList.remove('active');
            confirmDeleteInput.value = '';
        });

        confirmDeleteBtn.addEventListener('click', async function() {
            if (confirmDeleteInput.value === 'DELETE') {
                const success = await deleteAccount();
                if (success) {
                    showNotification('Account deleted successfully.', 'success');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                } else {
                    showNotification('Failed to delete account. Please try again.', 'error');
                }
            } else {
                showNotification('Please type "DELETE" to confirm account deletion.', 'error');
            }
        });

        // Activity Functions
        function addActivity(activity) {
            allActivities.unshift(activity);
            filterActivities();
        }

        function filterActivities() {
            if (currentFilter === 'all') {
                filteredActivities = [...allActivities];
            } else {
                filteredActivities = allActivities.filter(activity => activity.type === currentFilter);
            }
            displayActivities();
        }

        function displayActivities() {
            const activitiesToDisplay = filteredActivities.slice(0, activitiesToShow);
            
            activityList.innerHTML = '';
            
            if (activitiesToDisplay.length === 0) {
                activityList.innerHTML = '<p>No activities found for this filter.</p>';
                return;
            }
            
            activitiesToDisplay.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';
                
                // Set icon based on activity type
                let iconClass = 'fas fa-info-circle';
                if (activity.type === 'login') iconClass = 'fas fa-sign-in-alt';
                else if (activity.type === 'profile') iconClass = 'fas fa-user-edit';
                else if (activity.type === 'security') iconClass = 'fas fa-shield-alt';
                else if (activity.type === 'items') iconClass = 'fas fa-box';
                
                activityItem.innerHTML = `
                    <div class="activity-icon">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="activity-details">
                        <p><strong>${activity.title}</strong></p>
                        <p>${activity.description}</p>
                        <div class="activity-meta">
                            <span>${formatActivityDate(activity.timestamp)}</span>
                            <span>${activity.location || ''}</span>
                        </div>
                    </div>
                `;
                
                activityList.appendChild(activityItem);
            });
            
            // Show/hide load more button
            loadMoreActivityBtn.style.display = filteredActivities.length > activitiesToShow ? 'inline-block' : 'none';
        }

        function formatActivityDate(date) {
            const now = new Date();
            const activityDate = new Date(date);
            const diffMs = now - activityDate;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            
            return activityDate.toLocaleDateString();
        }

        // NEW: Export activity log as PDF
        function exportActivityLogAsPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add header
            doc.setFontSize(20);
            doc.setTextColor(40, 40, 40);
            doc.text('Activity Log - Lost & Found Hub', 20, 30);
            
            // Add user info
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text(`User: ${document.getElementById('profileUsername').textContent}`, 20, 45);
            doc.text(`Email: ${document.getElementById('profileEmail').textContent}`, 20, 55);
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 65);
            
            // Add table headers
            doc.setFontSize(11);
            doc.setTextColor(255, 255, 255);
            doc.setFillColor(76, 175, 80);
            doc.rect(20, 75, 170, 10, 'F');
            doc.text('Date', 22, 82);
            doc.text('Type', 60, 82);
            doc.text('Activity', 100, 82);
            doc.text('Description', 140, 82);
            
            // Add activity data
            let yPosition = 90;
            doc.setTextColor(0, 0, 0);
            
            allActivities.forEach((activity, index) => {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                    
                    // Add header on new page
                    doc.setFillColor(76, 175, 80);
                    doc.rect(20, yPosition, 170, 10, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.text('Date', 22, yPosition + 7);
                    doc.text('Type', 60, yPosition + 7);
                    doc.text('Activity', 100, yPosition + 7);
                    doc.text('Description', 140, yPosition + 7);
                    yPosition += 15;
                    doc.setTextColor(0, 0, 0);
                }
                
                const date = new Date(activity.timestamp).toLocaleDateString();
                const type = activity.type.charAt(0).toUpperCase() + activity.type.slice(1);
                
                doc.text(date, 22, yPosition);
                doc.text(type, 60, yPosition);
                
                // Handle text that might be too long
                const title = doc.splitTextToSize(activity.title, 30);
                const description = doc.splitTextToSize(activity.description, 40);
                
                doc.text(title, 100, yPosition);
                doc.text(description, 140, yPosition);
                
                // Move yPosition based on the tallest text block
                const titleHeight = title.length * 5;
                const descHeight = description.length * 5;
                yPosition += Math.max(titleHeight, descHeight) + 8;
            });
            
            // Add footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(10);
                doc.setTextColor(150, 150, 150);
                doc.text(`Page ${i} of ${pageCount}`, 105, 285, { align: 'center' });
                doc.text('Lost & Found Hub - Activity Log', 20, 285);
            }
            
            // Save the PDF
            doc.save(`activity-log-${document.getElementById('profileUsername').textContent}-${new Date().toISOString().split('T')[0]}.pdf`);
            
            showNotification('Activity log exported as PDF successfully!', 'success');
        }

        // Initialize sample activities
        function initializeSampleActivities() {
            const sampleActivities = [
                {
                    type: 'login',
                    title: 'Successful Login',
                    description: 'You logged in to your account',
                    timestamp: new Date(Date.now() - 30 * 60000), // 30 minutes ago
                    location: 'New York, USA'
                },
                {
                    type: 'profile',
                    title: 'Profile Updated',
                    description: 'You updated your profile information',
                    timestamp: new Date(Date.now() - 2 * 24 * 60 * 60000), // 2 days ago
                },
                {
                    type: 'security',
                    title: 'Password Changed',
                    description: 'You changed your account password',
                    timestamp: new Date(Date.now() - 7 * 24 * 60 * 60000), // 1 week ago
                },
                {
                    type: 'items',
                    title: 'Item Reported',
                    description: 'You reported a found item: Blue Water Bottle',
                    timestamp: new Date(Date.now() - 10 * 24 * 60 * 60000), // 10 days ago
                },
                {
                    type: 'login',
                    title: 'Failed Login Attempt',
                    description: 'Someone attempted to log in with incorrect credentials',
                    timestamp: new Date(Date.now() - 14 * 24 * 60 * 60000), // 2 weeks ago
                    location: 'Unknown Location'
                },
                {
                    type: 'security',
                    title: 'Security Questions Set',
                    description: 'You set up security questions for account recovery',
                    timestamp: new Date(Date.now() - 21 * 24 * 60 * 60000), // 3 weeks ago
                },
                {
                    type: 'items',
                    title: 'Item Claimed',
                    description: 'You claimed a lost item: Black Leather Wallet',
                    timestamp: new Date(Date.now() - 30 * 24 * 60 * 60000), // 1 month ago
                }
            ];
            
            allActivities = sampleActivities;
            filterActivities();
        }

        // API Functions
        async function loadUserProfile() {
            const token = localStorage.getItem("authToken");

            if (!token) {
                document.getElementById("profileUsername").textContent = "Guest";
                document.getElementById("profileEmail").textContent = "Not logged in";
                return;
            }

            try {
                const response = await fetch("http://localhost:3000/api/profile", {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Content-Type": "application/json"
                    }
                });

                const result = await response.json();

                if (result.success) {
                    const user = result.user;

                    document.getElementById('profileUsername').textContent = user.username || user.name || "No Name";
                    document.getElementById('profileEmail').textContent = user.email;
                    document.getElementById('profileFullName').textContent = user.fullName || "â€”";
                    document.getElementById('profileUsernameDetail').textContent = user.username;
                    document.getElementById('profileEmailDetail').textContent = user.email;
                    document.getElementById('profilePhone').textContent = user.phone || "â€”";
                    document.getElementById('profileLocation').textContent = user.location || "â€”";
                    
                    // Format member since date
                    if (user.created_at) {
                        const memberSince = new Date(user.created_at).toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long'
                        });
                        document.getElementById('memberSince').textContent = memberSince;
                    } else {
                        document.getElementById('memberSince').textContent = "â€”";
                    }
                    
                    // Populate edit form
                    document.getElementById('editFullName').value = user.fullName || "";
                    document.getElementById('editUsername').value = user.username || "";
                    document.getElementById('editEmail').value = user.email || "";
                    document.getElementById('editPhone').value = user.phone || "";
                    document.getElementById('editLocation').value = user.location || "";
                    
                    // Update dropdown
                    document.getElementById('username').textContent = user.username || user.name || "No Name";
                    document.getElementById('useremail').textContent = user.email;
                    
                    // Set avatar in all locations if available
                    if (user.avatar) {
                        updateAllAvatars(user.avatar);
                    } else {
                        // Use default avatar
                        updateAllAvatars('https://i.pravatar.cc/150?img=12');
                    }
                } else {
                    document.getElementById("profileUsername").textContent = "Error";
                    document.getElementById("profileEmail").textContent = result.message;
                }
            } catch (err) {
                console.error("Profile fetch failed:", err);
                document.getElementById("profileUsername").textContent = "Error";
                document.getElementById("profileEmail").textContent = "Could not load profile";
            }
        }

        async function updateProfile(profileData) {
            const token = localStorage.getItem("authToken");
            
            try {
                const response = await fetch("http://localhost:3000/api/profile", {
                    method: "PUT",
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(profileData)
                });

                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.message || 'Failed to update profile');
                }
                
                return result.success;
            } catch (err) {
                console.error("Profile update failed:", err);
                showNotification(err.message || 'Failed to update profile. Please try again.', 'error');
                return false;
            }
        }

        async function uploadAvatar(file) {
            const token = localStorage.getItem("authToken");
            const formData = new FormData();
            formData.append('avatar', file);
            
            try {
                const response = await fetch("http://localhost:3000/api/profile/avatar", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${token}`
                    },
                    body: formData
                });

                const result = await response.json();
                
                if (result.success && result.avatarUrl) {
                    updateAllAvatars(result.avatarUrl);
                }
                
                return result.success;
            } catch (err) {
                console.error("Avatar upload failed:", err);
                return false;
            }
        }

        async function changePassword(currentPassword, newPassword) {
            const token = localStorage.getItem("authToken");
            
            try {
                const response = await fetch("http://localhost:3000/api/profile/password", {
                    method: "PUT",
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        currentPassword,
                        newPassword
                    })
                });

                const result = await response.json();
                return result.success;
            } catch (err) {
                console.error("Password change failed:", err);
                return false;
            }
        }

        async function enableTwoFactorAuth(code) {
            const token = localStorage.getItem("authToken");
            
            try {
                const response = await fetch("http://localhost:3000/api/profile/2fa", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ code })
                });

                const result = await response.json();
                return result.success;
            } catch (err) {
                console.error("2FA enable failed:", err);
                return false;
            }
        }

        async function deleteAccount() {
            const token = localStorage.getItem("authToken");
            
            try {
                const response = await fetch("http://localhost:3000/api/profile", {
                    method: "DELETE",
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Content-Type": "application/json"
                    }
                });

                const result = await response.json();
                return result.success;
            } catch (err) {
                console.error("Account deletion failed:", err);
                return false;
            }
        }

        // Notification function
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.padding = '15px 20px';
            notification.style.borderRadius = '5px';
            notification.style.color = 'white';
            notification.style.fontWeight = '500';
            notification.style.zIndex = '10000';
            notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            notification.style.transition = 'opacity 0.3s';
            
            if (type === 'success') {
                notification.style.backgroundColor = '#4CAF50';
            } else if (type === 'error') {
                notification.style.backgroundColor = '#e74c3c';
            } else {
                notification.style.backgroundColor = '#3498db';
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Initialize page
        window.addEventListener('DOMContentLoaded', () => {
            loadUserProfile();
            initializeSampleActivities();
        });
    </script>
</body>
</html>